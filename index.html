<!DOCTYPE html>

<html>

    <head>

        <title>Coms</title>

        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!-- Adds buttons that don't refresh the page-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
        
        <script>

            $(document).ready(function() {

                var current_socket
                
                console.log("DOG READY");
                
                function append_text(text) {
                    var box = document.getElementById("box")
                    box.innerHTML = box.innerHTML + text
                }

                function on_submit(event) {

                    var message = $("form#msg input").val();
                    var address = $("form#address input").val();
                    $("form#msg input").val("");

                    if (current_socket == null || address != current_socket.url) {
                        append_text("<i>Connecting..</i>")
                        current_socket = new WebSocket(address)
                    };

                    console.log(`Submit \"${message}\" to ${address}`)
                    append_text(`<b>You</b>: ${message}`)

                    return false;
                }
                
                $("form#address").submit(on_submit)
                $("form#msg").submit(on_submit)

            })

        </script>

    </head>

    <body>

        <div style="position: fixed; min-height: 10%;">
            <form id="address">
                <label for="a">Server Address</label>
                <input type="text" id="a">
            </form>
            
            <form id="msg">
                <label for="m">Message Content</label>
                <input type="text" id="m">
                <input type="submit" value="Send">
            </form>
        </div>

        <br>
        <br>
        <br>

        <div id="box">

        </div>
        

    </body>


</html>
